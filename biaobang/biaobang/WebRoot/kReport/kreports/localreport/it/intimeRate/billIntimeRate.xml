<?xml version="1.0" encoding="GB2312"?> 
<kreport>
	<name>billIntimeRate</name>
	<display-name>投诉管控及时率</display-name>
	<pageable></pageable>
	<condition-size>4</condition-size>
	<skin></skin>	
	<actions>
		<action name="query">
			<index>10</index>
			<display-name>查询</display-name>
			<do>doQuery()</do>
		</action>
		<action name="export">
			<index>20</index>
			<display-name>导出</display-name>
			<do>doExport()</do>
		</action>
		<action name="reset">
			<index>100</index>
			<display-name>重置</display-name>
			<do>doReset()</do>
		</action>
	</actions>
	<conditions>
		<condition name="startGendate">
			<index>1</index>
			<display-name>报障时间(开始)</display-name>
			<type>date</type>
			<return-type>date</return-type>
			<extend>yyyy-MM-dd HH:mm</extend>
			<default-value></default-value>
		</condition>
		<condition name="endGendate">
			<index>5</index>
			<display-name>报障时间(结束)</display-name>
			<type>date</type>
			<return-type>date</return-type>
			<extend>yyyy-MM-dd HH:mm</extend>
			<default-value></default-value>
		</condition>
		<condition name="startDate">
			<index>10</index>
			<display-name>回单时间(开始)</display-name>
			<type>date</type>
			<return-type>date</return-type>
			<extend>yyyy-MM-dd HH:mm</extend>
			<default-value></default-value>
		</condition>
		<condition name="endDate">
			<index>20</index>
			<display-name>回单时间(结束)</display-name>
			<type>date</type>
			<return-type>date</return-type>
			<extend>yyyy-MM-dd HH:mm</extend>
			<default-value></default-value>
		</condition>		
		<condition name="isNotIT">
			<index>30</index>
			<display-name>是否剔除非IT引起的超时</display-name>
			<type>select</type>
			<return-type>void</return-type>
			<extend>{剔除非IT引起的超时:剔除}</extend>
		</condition>		
		<condition name="dispatchdest">
			<index>40</index>
			<display-name>首派部门</display-name>
			<type>select</type>
			<return-type>string</return-type>
			<extend>{ITZX:IT中心,YZ:业支}</extend>
		</condition>		
	</conditions>	
	<data>
		<tbody><![CDATA[
			<tr style='font-size:9pt;font-family:宋体;line-height:14pt;	background-color:white;'>
				<td align='center'>${1}</td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','${2}','area=${1}')">${2}</a></td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','${3}','area=${1}&overtime=is')">${3}</a></td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','${4}','area=${1}&overtime=is not')">${4}</a></td>
				<td align='center'>${5}%</td>
			</tr>]]>
		</tbody>
		<tfoot><![CDATA[
			<tr style='font-size:9pt;font-family:宋体;color:#ff0000;line-height:14pt;	background-color:white;'>
				<td align='center' colspan=1>合计</td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','$[round(${2})]','')">$[round(${2})]</a></td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','$[round(${3})]','overtime=is')">$[round(${3})]</a></td>
				<td align='center'><a href="javascript:openList('/itsm/localreport/billIntimeRateBill','$[round(${4})]','overtime=is not')">$[round(${4})]</a></td>
				<td align='center'>$[round(${3}*10000/${2})/100]%</td>				
			</tr>
		]]>
		</tfoot>
	</data>		
	<ksql><![CDATA[
		select d.dname 区域,
		       nvl(c.total,0) 工单总数,
		       nvl(c.total,0)-nvl(o.total,0) 未超时单数,
		       nvl(o.total,0) 流程超时单数,
		       nvl2(c.total,round((c.total-nvl(o.total,0))*100/c.total,2),0) 处理及时率
		from sys_data_dictionary d,
		(
		    select i.area,count(*) total    
		    from rec_flow f,ins_frm_fault i,chk_assessment_result r
		    where f.flowlsh=i.flowlsh
		      and f.flowlsh=r.rec_flow_id
		      and f.status!='XJ'
		      and f.startercode='8a92634621adf5510121ae02a34f0003'  --10000号主办
		      and r.assessment_type='F'
		      and r.total_time>0		      
      		  #[and i.dispatchdest=${dispatchdest}]
		      #[and f.gendate>=${startGendate}]
		      #[and f.gendate< ${endGendate}]
		      #[and i.replytime>=${startDate}]
		      #[and i.replytime< ${endDate}]
		    group by i.area
		) c,
		(
		    select i.area,count(*) total  
		    from rec_flow f,ins_frm_fault i,chk_assessment_result r
		    where f.flowlsh=i.flowlsh
		      and f.flowlsh=r.rec_flow_id
		      and f.status!='XJ'
		      and f.startercode='8a92634621adf5510121ae02a34f0003'  --10000号主办
		      and r.assessment_type='F'
		      and round(r.used_time/60000)>r.total_time
		      and r.total_time>0
      		  #[and i.dispatchdest=${dispatchdest}]
		      #[and f.gendate>=${startGendate}]
		      #[and f.gendate< ${endGendate}]
		      #[and i.replytime>=${startDate}]
		      #[and i.replytime< ${endDate}]
		      #[and not exists(
		          select 1 from chk_assessment_result ro,chk_entity e,sec_rank rank
		          where ro.rec_flow_id=f.flowlsh 
		            and ro.assessment_type = 'O' 
		            and ro.assessment_id=e.assessment_id
		            and e.entiy_id=rank.value
		            and rank.type in ('业支','电子运维')
		            and round(ro.used_time/60000)>ro.total_time
		            and round(r.used_time/60000)>r.total_time
		      )--${isNotIT}]
		    group by i.area
		) o
		where d.dvalue=c.area(+)
		  and d.dvalue=o.area(+)
		  and d.dgroup='区域'
		  #[and d.dvalue in (${s@user_areas})]
		order by d.ordernum
		]]></ksql>
	<comment><![CDATA[报表说明：
1) 投诉管理及时率报表统计10000号主办单的处理情况；
2) 一次性解决率=处理及时率/工单总数×100%；
]]>
	</comment>
</kreport>